<!-- 6a4086b2-1baa-473e-861b-03f87886e543 f8115e65-6552-4d68-93a4-e0ed3578368e -->
# –ü–ª–∞–Ω: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–ø–ª–æ—è –∏ –∑–∞–ø—É—Å–∫ Mini App

## –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

–î–µ–ø–ª–æ–π **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —É—Å–ø–µ—à–µ–Ω** - `index.html` —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞–π–¥–µ–Ω –≤–æ –≤—Ç–æ—Ä–æ–π –ø–æ–ø—ã—Ç–∫–µ:
- –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ (17:16:10): ERROR - index.html not found
- –í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ (17:17:29): SUCCESS - index.html –Ω–∞–π–¥–µ–Ω –≤ `/out`
- –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ: `‚úì Generating static pages (7/7)`

## –ü—Ä–æ–±–ª–µ–º–∞

**–ö–æ–Ω—Ñ–ª–∏–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: `next.config.js` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `output: 'export'`, –Ω–æ `package.json` build –∫–æ–º–∞–Ω–¥–∞ –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ `.next/server/app/` –≤ `out/`. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å.

–°–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º Cursor (.cursorrules):
```javascript
output: 'export',           // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
trailingSlash: true,        // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è TimeWeb Cloud
```

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–∏–≤–µ—Å—Ç–∏ next.config.js –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏

**–§–∞–π–ª:** `next.config.js`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
// output: 'export', // –û—Ç–∫–ª—é—á–∞–µ–º –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ API routes
```

**–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å `output: 'export'` –∏ —É–¥–∞–ª–∏—Ç—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –æ–ø—Ü–∏–∏
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',           // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è TimeWeb Cloud
  trailingSlash: true,        // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è TimeWeb Cloud
  images: {
    unoptimized: true,        // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
    domains: ['telegram.org', 'cdn.telegram.org'],
    formats: ['image/webp', 'image/avif'],
  },
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
};

module.exports = nextConfig;
```

**–£–¥–∞–ª–∏—Ç—å:** `async headers()` –∏ `async rewrites()` - –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —ç–∫—Å–ø–æ—Ä—Ç–æ–º

### 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å build –∫–æ–º–∞–Ω–¥—É

**–§–∞–π–ª:** `package.json`

**–¢–µ–∫—É—â–∞—è –∫–æ–º–∞–Ω–¥–∞:**
```json
"build": "next build && mkdir -p out && cp -r .next/server/app/* out/ 2>/dev/null || true && cp -r public/* out/ 2>/dev/null || true"
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ `.next/server/app/` –∏–∑–ª–∏—à–Ω–µ –ø—Ä–∏ `output: 'export'`, —Ç.–∫. Next.js —Å–∞–º —Å–æ–∑–¥–∞–µ—Ç `out/`

**–†–µ—à–µ–Ω–∏–µ:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
```json
"build": "next build"
```

–ü—Ä–∏ `output: 'export'` Next.js –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –ø–∞–ø–∫—É `out/` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è

–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP —Å—Ç–∞—Ç—É—Å
curl -I https://alexkohinor-lawerapp-telegram-mini-app-7e7a.twc1.net

# –ï—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ TimeWeb Cloud API
```

### 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram Web App

**–°–∫—Ä–∏–ø—Ç:** `scripts/setup-telegram-webapp.ts`

–í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É:
```bash
TELEGRAM_BOT_TOKEN=8208499008:AAHd9069cfFeM0OIqWrm86QyM0DEUBbV2z8 \
TELEGRAM_WEBAPP_URL=https://[–Ω–æ–≤—ã–π-–¥–æ–º–µ–Ω].twc1.net \
npm run setup:telegram
```

–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```bash
# –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
curl https://api.telegram.org/bot8208499008:AAHd9069cfFeM0OIqWrm86QyM0DEUBbV2z8/getMe

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
curl -X POST https://api.telegram.org/bot8208499008:AAHd9069cfFeM0OIqWrm86QyM0DEUBbV2z8/setMyCommands \
  -H "Content-Type: application/json" \
  -d '{"commands":[{"command":"start","description":"üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å LawerApp"}]}'
```

### 5. –°–æ–∑–¥–∞—Ç—å env.example –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

**–§–∞–π–ª:** `env.production.example`

```env
# Production Environment Variables for TimeWeb Cloud
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-app.twc1.net
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_BOT_USERNAME=miniappadvokat_bot
S3_ENDPOINT=https://s3.twcstorage.ru
S3_REGION=ru-1
S3_ACCESS_KEY=your_access_key
S3_SECRET_KEY=your_secret_key
S3_BUCKET_NAME=your_bucket_name
```

### 6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Mini App

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
1. –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ @miniappadvokat_bot –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/start`
3. –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É Mini App (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (—Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/test`, `/miniapp-test`)

### 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–§–∞–π–ª:** `docs/DEPLOYMENT_FIX.md`

–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
- –ù–∞–π–¥–µ–Ω–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã (–∫–æ–Ω—Ñ–ª–∏–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è (–≤–∫–ª—é—á–µ–Ω–∏–µ `output: 'export'`)
- –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å `next.config.js` (–≤–∫–ª—é—á–∏—Ç—å `output: 'export'`, —É–¥–∞–ª–∏—Ç—å headers)
2. –£–ø—Ä–æ—Å—Ç–∏—Ç—å build –∫–æ–º–∞–Ω–¥—É –≤ `package.json`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ: `npm run build` –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `out/index.html`
4. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –ó–∞–ø—É—à–∏—Ç—å –≤ GitHub
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è –Ω–∞ TimeWeb Cloud
7. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram Web App URL —á–µ—Ä–µ–∑ `npm run setup:telegram`
8. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Mini App –≤ Telegram

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º Cursor
- ‚úÖ Build –∫–æ–º–∞–Ω–¥–∞ —É–ø—Ä–æ—â–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ `out/index.html` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –î–µ–ø–ª–æ–π –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ Telegram Web App URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Mini App –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞

### To-dos

- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å next.config.js - –≤–∫–ª—é—á–∏—Ç—å output: 'export' –∏ —É–¥–∞–ª–∏—Ç—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –æ–ø—Ü–∏–∏
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å build –∫–æ–º–∞–Ω–¥—É –≤ package.json - —É–¥–∞–ª–∏—Ç—å —Ä—É—á–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ out/index.html
- [ ] –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] –ó–∞–ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ GitHub
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è –Ω–∞ TimeWeb Cloud
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram Web App URL –∏ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Mini App –≤ Telegram
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö –¥–µ–ø–ª–æ—è