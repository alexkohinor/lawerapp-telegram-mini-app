# Cursor Rules –¥–ª—è LawerApp Telegram Mini App

## üöÄ TimeWeb Cloud Deployment Rules

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ò–∑–±–µ–≥–∞–π—Ç–µ —Ä–µ–∫—É—Ä—Å–∏–∏ –≤ build —Å–∫—Ä–∏–ø—Ç–∞—Ö!

**‚ùå –ù–ò–ö–û–ì–î–ê –ù–ï –î–ï–õ–ê–ô–¢–ï:**
```json
{
  "scripts": {
    "build": "./build-script.sh"  // –≥–¥–µ build-script.sh —Å–æ–¥–µ—Ä–∂–∏—Ç npm run build
  }
}
```

**‚úÖ –í–°–ï–ì–î–ê –î–ï–õ–ê–ô–¢–ï:**
```json
{
  "scripts": {
    "build": "next build && mkdir -p out && cp -r .next/server/app/* out/ 2>/dev/null || true && cp -r public/* out/ 2>/dev/null || true"
  }
}
```

### Next.js Configuration –¥–ª—è TimeWeb Cloud

**next.config.js –î–û–õ–ñ–ï–ù —Å–æ–¥–µ—Ä–∂–∞—Ç—å:**
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',           // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
  trailingSlash: true,        // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è TimeWeb Cloud
  images: {
    unoptimized: true,        // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞
    domains: ['telegram.org', 'cdn.telegram.org'],
    formats: ['image/webp', 'image/avif'],
  },
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
};

module.exports = nextConfig;
```

### Package.json Requirements

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```json
{
  "dependencies": {
    "next": "^15.5.6",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@twa-dev/sdk": "^8.0.2"
  },
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=8.0.0"
  }
}
```

**Build —Å–∫—Ä–∏–ø—Ç –î–û–õ–ñ–ï–ù –±—ã—Ç—å:**
```json
{
  "scripts": {
    "build": "next build && mkdir -p out && cp -r .next/server/app/* out/ 2>/dev/null || true && cp -r public/* out/ 2>/dev/null || true"
  }
}
```

### TimeWeb Cloud Specific Files

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï —Ñ–∞–π–ª—ã:**
- `.nvmrc` - —Å–æ–¥–µ—Ä–∂–∏—Ç `18.20.0`
- `.npmrc` - —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤:
  ```
  fetch-timeout=600000
  fetch-retry-maxtime=600000
  fetch-retry-mintime=10000
  ```

**–ù–ï –°–û–ó–î–ê–í–ê–ô–¢–ï:**
- ‚ùå `build-for-timeweb.sh`
- ‚ùå `build-and-export.sh`
- ‚ùå –õ—é–±—ã–µ –≤–Ω–µ—à–Ω–∏–µ build —Å–∫—Ä–∏–ø—Ç—ã

### Environment Variables –¥–ª—è TimeWeb Cloud

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```env
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-app.timeweb.cloud
DATABASE_URL=postgresql://user:pass@host:port/db
S3_ENDPOINT=https://s3.twcstorage.ru
S3_REGION=ru-1
S3_ACCESS_KEY=your_access_key
S3_SECRET_KEY=your_secret_key
S3_BUCKET_NAME=your_bucket_name
TELEGRAM_BOT_TOKEN=your_bot_token
```

### TypeScript Rules

**–ò–°–ü–†–ê–í–õ–Ø–ô–¢–ï –í–°–ï–ì–î–ê:**
- ‚ùå `error: any` ‚Üí ‚úÖ `error instanceof Error ? error.message : String(error)`
- ‚ùå `response.Body as any` ‚Üí ‚úÖ `response.Body as AsyncIterable<Uint8Array>`
- ‚ùå `any` —Ç–∏–ø—ã ‚Üí ‚úÖ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã –∏–ª–∏ `unknown`

### Testing Before Deployment

**–í–°–ï–ì–î–ê –¢–ï–°–¢–ò–†–£–ô–¢–ï –õ–û–ö–ê–õ–¨–ù–û:**
```bash
rm -rf out .next
npm run build
ls -la out/  # –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å index.html
```

### Git Commit Messages

**–ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –ü–û–ù–Ø–¢–ù–´–ï —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üöÄ ULTIMATE FIX: Remove recursive build scripts, inline build commands
üîß Fix: TimeWeb Cloud deployment configuration
‚úÖ Test: Local build verification
```

### Troubleshooting

**–ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ build —Å–∫—Ä–∏–ø—Ç –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç —Ä–µ–∫—É—Ä—Å–∏–∏: `npm run build` ‚Üí `./script.sh` ‚Üí `npm run build`
3. –í—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞–ø—Ä—è–º—É—é –≤ package.json

**–ï—Å–ª–∏ "index.html not found in /out":**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ build —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç –ø–∞–ø–∫—É `out`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –∏–∑ `.next/server/app/` –≤ `out/`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `output: 'export'` –≤ next.config.js

### Performance Optimization

**–û–ü–¢–ò–ú–ò–ó–ò–†–£–ô–¢–ï –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- –£–¥–∞–ª—è–π—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `npm ci --omit=dev` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.npmrc` –¥–ª—è —Ç–∞–π–º–∞—É—Ç–æ–≤

### Security

**–ù–ï –ö–û–ú–ú–ò–¢–¨–¢–ï:**
- `.env` —Ñ–∞–π–ª—ã
- API –∫–ª—é—á–∏
- –ü–∞—Ä–æ–ª–∏
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ò–°–ü–û–õ–¨–ó–£–ô–¢–ï:**
- `env.example` –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ TimeWeb Cloud
- `.gitignore` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–ª–µ–¥—É—è —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º, –¥–µ–ø–ª–æ–π –Ω–∞ TimeWeb Cloud –±—É–¥–µ—Ç:
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–º (–±–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏)
- ‚úÖ –ù–∞–¥–µ–∂–Ω—ã–º (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–º (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–º (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
