# üéâ Backend MVP Phase 9.1 - –ó–ê–í–ï–†–®–ï–ù!

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 22 –æ–∫—Ç—è–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è:** 1.0.0 MVP  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ 100% –ó–ê–í–ï–†–®–ï–ù–û

---

## üìä –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ: 10 –∏–∑ 10 –∑–∞–¥–∞—á (100%)

**Sprint 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (5 –∑–∞–¥–∞—á)**
- ‚úÖ 1.1 Prisma Schema Extension
- ‚úÖ 1.2 –ë–∞–∑–æ–≤—ã–µ API Routes
- ‚úÖ 1.3 API –¥–µ—Ç–∞–ª–µ–π —Å–ø–æ—Ä–∞
- ‚úÖ 1.4 API –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ 1.5 API –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–∞–ª–æ–≥–æ–≤

**Sprint 2: –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ AI (3 –∑–∞–¥–∞—á–∏)**
- ‚úÖ 2.1 –®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ 2.2 AI-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ 2.3 PDF/DOCX —ç–∫—Å–ø–æ—Ä—Ç

**Sprint 3: AI –ê–Ω–∞–ª–∏–∑ –∏ RAG (2 –∑–∞–¥–∞—á–∏)**
- ‚úÖ 3.1 AI Tax Analyzer
- ‚úÖ 3.2 RAG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## üöÄ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (8 –º–æ–¥–µ–ª–µ–π Prisma)

#### –ù–∞–ª–æ–≥–æ–≤—ã–µ —Å–ø–æ—Ä—ã:
- `TaxDispute` - –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å —Å–ø–æ—Ä–∞
- `TaxDisputeDocument` - –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ —Å–ø–æ—Ä—É
- `TaxDisputeTimeline` - —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—è —Å–æ–±—ã—Ç–∏–π
- `TaxCalculation` - —Ä–∞—Å—á–µ—Ç—ã –Ω–∞–ª–æ–≥–æ–≤
- `TransportTaxRate` - —Å—Ç–∞–≤–∫–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞
- `TaxDocumentTemplate` - —à–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### AI –°–∏—Å—Ç–µ–º–∞:
- `AIPromptTemplate` - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- `AIPromptUsageLog` - –ª–æ–≥–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è TypeScript
- Relations –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
- Indexes –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- JSON –ø–æ–ª—è –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
- Cascade —É–¥–∞–ª–µ–Ω–∏–µ

### 2. API Endpoints (14 –º–∞—Ä—à—Ä—É—Ç–æ–≤)

#### –ù–∞–ª–æ–≥–æ–≤—ã–µ —Å–ø–æ—Ä—ã:
```
POST   /api/tax/disputes                    - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ø–æ—Ä–∞
GET    /api/tax/disputes                    - —Å–ø–∏—Å–æ–∫ —Å–ø–æ—Ä–æ–≤
GET    /api/tax/disputes/[id]               - –¥–µ—Ç–∞–ª–∏ —Å–ø–æ—Ä–∞
PATCH  /api/tax/disputes/[id]               - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
DELETE /api/tax/disputes/[id]               - —É–¥–∞–ª–µ–Ω–∏–µ
POST   /api/tax/disputes/[id]/analyze       - AI-–∞–Ω–∞–ª–∏–∑
GET    /api/tax/disputes/[id]/analyze       - –ø–æ–ª—É—á–∏—Ç—å –∞–Ω–∞–ª–∏–∑
POST   /api/tax/disputes/[id]/precedents    - –ø–æ–∏—Å–∫ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç–æ–≤
GET    /api/tax/disputes/[id]/precedents    - –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ã
```

#### –î–æ–∫—É–º–µ–Ω—Ç—ã:
```
POST   /api/tax/documents/generate          - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
POST   /api/tax/documents/[id]/export       - —ç–∫—Å–ø–æ—Ä—Ç PDF/DOCX
GET    /api/tax/documents/[id]/export       - —Å—Ç–∞—Ç—É—Å —ç–∫—Å–ø–æ—Ä—Ç–∞
GET    /api/tax/documents/[id]/download     - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
```

#### –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã:
```
POST   /api/tax/calculator/transport        - —Ä–∞—Å—á–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞
```

#### –ê–¥–º–∏–Ω–∫–∞:
```
GET    /api/admin/prompts                   - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–º–ø—Ç–æ–≤
POST   /api/admin/prompts                   - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
PATCH  /api/admin/prompts                   - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
GET    /api/admin/prompts/[id]/stats        - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–º–ø—Ç–∞
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- Error handling
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ timeline
- Pagination –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### 3. AI –°–∏—Å—Ç–µ–º–∞

#### 3.1 AI Document Generator
**–§–∞–π–ª:** `src/lib/tax/ai-document-generator.ts`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
- OpenAI GPT-4 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ü—Ä–æ–º–ø—Ç—ã –∏–∑ –ë–î (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ)
- –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–µ–π—Å—Ç–≤–∏—è–º
- –û—Ü–µ–Ω–∫–∞ —à–∞–Ω—Å–æ–≤ –Ω–∞ —É—Å–ø–µ—Ö

**–§—É–Ω–∫—Ü–∏–∏:**
- `generateTaxDocument()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `analyzeTaxSituation()` - –∫—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑
- `interpolateUserPrompt()` - –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- Fallback –ø—Ä–æ–º–ø—Ç—ã

#### 3.2 AI Tax Analyzer
**–§–∞–π–ª:** `src/lib/tax/ai-tax-analyzer.ts`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞–ª–æ–≥–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- –í—ã—è–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ (6 —Ç–∏–ø–æ–≤)
- –ü–æ–∏—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π (5 —Ç–∏–ø–æ–≤)
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–æ–≤—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
- –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –æ—Å–ø–∞—Ä–∏–≤–∞–Ω–∏—è
- –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤ –∏ –∑–∞—Ç—Ä–∞—Ç
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ (0-100%)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–Ω–∞–ª–∏–∑–∞:**
```typescript
{
  overallAssessment: string,
  successProbability: number,
  detectedErrors: TaxError[],
  proceduralViolations: ProceduralViolation[],
  legalArguments: LegalArgument[],
  recommendedActions: RecommendedAction[],
  estimatedTimeline: string,
  estimatedCosts: {...},
  risks: Risk[],
  strategy: {...},
  precedents: Precedent[]  // RAG
}
```

#### 3.3 AI Prompt Service
**–§–∞–π–ª:** `src/lib/tax/ai-prompt-service.ts`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–º–ø—Ç—ã –≤ –ë–î (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- Feedback system
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ú–µ—Ç—Ä–∏–∫–∏:**
- usageCount
- successRate
- avgResponseTime
- positiveVotes/negativeVotes
- userRating (1-5)

### 4. RAG –°–∏—Å—Ç–µ–º–∞

#### 4.1 RAG Precedent Finder
**–§–∞–π–ª:** `src/lib/tax/rag-precedent-finder.ts`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç–æ–≤
- –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î TimeWeb Cloud
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∞–≤–æ–≤—ã—Ö –æ—Å–Ω–æ–≤–∞–Ω–∏–π
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–∏–º—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç
- –£–ª—É—á—à–µ–Ω–∏–µ AI-–∞–Ω–∞–ª–∏–∑–∞

**–§—É–Ω–∫—Ü–∏–∏:**
- `findRelevantPrecedents()` - –ø–æ–∏—Å–∫
- `enhanceAnalysisWithPrecedents()` - —É–ª—É—á—à–µ–Ω–∏–µ
- `findPrecedentsByIssue()` - –ø–æ –ø—Ä–æ–±–ª–µ–º–µ
- `findRelevantLegalArticles()` - —Å—Ç–∞—Ç—å–∏ –ù–ö –†–§
- `generateCitationsForDocument()` - —Ü–∏—Ç–∞—Ç—ã

**–¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
- law - –∑–∞–∫–æ–Ω—ã, –ù–ö –†–§
- precedent - —Å—É–¥–µ–±–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- template - —à–∞–±–ª–æ–Ω—ã
- guideline - –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 5. –≠–∫—Å–ø–æ—Ä—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### 5.1 Document Export Service
**–§–∞–π–ª:** `src/lib/tax/document-export-service.ts`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF (jsPDF)
- –≠–∫—Å–ø–æ—Ä—Ç –≤ DOCX (RTF)
- –ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤ S3
- Signed URLs (1 —á–∞—Å)

**–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PDF:**
- A4, –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è
- –ü–æ–ª—è 20–º–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–∞–Ω–∏—Ü
- –ó–∞–≥–æ–ª–æ–≤–∫–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- –õ–∏–Ω–∏–∏-—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
- Word wrap

**–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DOCX:**
- RTF —Ñ–æ—Ä–º–∞—Ç (Word-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
- Times New Roman
- –ö–∏—Ä–∏–ª–ª–∏—Ü–∞
- –ü–∞—Ä–∞–≥—Ä–∞—Ñ—ã, –∑–∞–≥–æ–ª–æ–≤–∫–∏

### 6. –®–∞–±–ª–æ–Ω—ã –∏ –¥–∞–Ω–Ω—ã–µ

#### 6.1 –®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (4 —Ç–∏–ø–∞)
1. **–ó–∞—è–≤–ª–µ–Ω–∏–µ –æ –ø–µ—Ä–µ—Ä–∞—Å—á–µ—Ç–µ**
   - 15+ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
   - –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å—á–µ—Ç–æ–≤
   - 5 —Å—Ç–∞—Ç–µ–π –ù–ö –†–§

2. **–ñ–∞–ª–æ–±–∞ –≤ –£–§–ù–°**
   - –ù–∞—Ä—É—à–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–∞
   - –ù–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–∞
   - –°—É–¥–µ–±–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞

3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–µ—Å–æ–≥–ª–∞—Å–∏–∏**
   - –ö—Ä–∞—Ç–∫–∞—è —Ñ–æ—Ä–º–∞
   - –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç. 142 –ù–ö –†–§ (–ø—Ä–∞–≤–æ –Ω–∞ —Å—É–¥)

4. **–í–æ–∑—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∞–∫—Ç**
   - –ù–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞
   - –û—à–∏–±–∫–∏ –≤ –±–∞–∑–µ

#### 6.2 –ù–∞–ª–æ–≥–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏ (66 –∑–∞–ø–∏—Å–µ–π)
**–†–µ–≥–∏–æ–Ω—ã:** 3 (–ú–æ—Å–∫–≤–∞, –°–ü–±, –ú–û)  
**–¢–∏–ø—ã –¢–°:** 4 (car, motorcycle, truck, bus)  
**–ì–æ–¥—ã:** 2 (2024, 2025)

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:** –ó–∞–∫–æ–Ω—ã —Å—É–±—ä–µ–∫—Ç–æ–≤ –†–§

#### 6.3 AI –ü—Ä–æ–º–ø—Ç—ã (5 —Ç–∏–ø–æ–≤)
1. document_generation (transport)
2. analysis (transport)
3. document_generation (general)
4. analysis (general)
5. tax_analysis (transport) - –¥–µ—Ç–∞–ª—å–Ω—ã–π

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ö–æ–¥:
- **–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 22
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~7500+
- **TypeScript:** 100% —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **API endpoints:** 14
- **–ö–æ–º–º–∏—Ç–æ–≤:** 12

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- **–ú–æ–¥–µ–ª–µ–π:** 8
- **Relations:** –ø–æ–ª–Ω–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å
- **Indexes:** –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- **–î–∞–Ω–Ω—ã—Ö:** 66 —Å—Ç–∞–≤–æ–∫, 4 —à–∞–±–ª–æ–Ω–∞, 5 –ø—Ä–æ–º–ø—Ç–æ–≤

### AI:
- **–ü—Ä–æ–º–ø—Ç–æ–≤:** 5 –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö
- **Temperature:** 0.2-0.5
- **Max tokens:** 500-4000
- **Model:** GPT-4
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ø–æ–ª–Ω–æ–µ

### RAG:
- **Vector DB:** TimeWeb Cloud
- **Embeddings:** text-embedding-3-small
- **Dimensions:** 1536
- **Min relevance:** 0.7-0.8

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ—Å—Ç—å
- ‚úÖ –ü—Ä–æ–º–ø—Ç—ã –≤ –ë–î (–∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å)
- ‚úÖ –®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ù–∞–ª–æ–≥–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏
- ‚úÖ AI –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (temperature, tokens, model)

### 2. –û–±—É—á–∞–µ–º–æ—Å—Ç—å
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö AI –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ Feedback system (—Ä–µ–π—Ç–∏–Ω–≥–∏, –≥–æ–ª–æ—Å–∞)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
- ‚úÖ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤
- ‚úÖ –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ

### 3. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ Prisma ORM
- ‚úÖ PostgreSQL
- ‚úÖ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- ‚úÖ Vector DB
- ‚úÖ API-first architecture

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ Error handling
- ‚úÖ Signed URLs
- ‚úÖ Private S3

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ Timeline events
- ‚úÖ Usage logs
- ‚úÖ Performance metrics
- ‚úÖ Error tracking
- ‚úÖ Statistics

---

## üîÑ Workflow

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ —Å–ø–æ—Ä–∞:
1. `POST /api/tax/disputes` - —Å–æ–∑–¥–∞–Ω–∏–µ
2. `POST /api/tax/calculator/transport` - —Ä–∞—Å—á–µ—Ç (optional)
3. `POST /api/tax/disputes/[id]/analyze` - AI-–∞–Ω–∞–ª–∏–∑
4. `POST /api/tax/disputes/[id]/precedents` - –ø–æ–∏—Å–∫ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç–æ–≤
5. `POST /api/tax/documents/generate` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
6. `POST /api/tax/documents/[id]/export` - —ç–∫—Å–ø–æ—Ä—Ç PDF/DOCX
7. `GET /api/tax/documents/[id]/download` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ

### –ê–¥–º–∏–Ω–∫–∞:
1. `GET /api/admin/prompts` - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–º–ø—Ç–æ–≤
2. `PATCH /api/admin/prompts` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. `GET /api/admin/prompts/[id]/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
4. –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ feedback
5. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend:
- Next.js 15 API Routes
- TypeScript 5.9
- Prisma ORM 6.17
- PostgreSQL (TimeWeb Cloud)
- OpenAI GPT-4

### Storage:
- S3 (TimeWeb Cloud)
- Vector DB (TimeWeb Cloud)
- Embedding Service

### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- Zod 4.1
- TypeScript

### PDF/DOCX:
- jsPDF 3.0
- RTF –¥–ª—è DOCX

### AI:
- OpenAI SDK 4.52
- Temperature: 0.2-0.5
- Models: GPT-4

---

## üìù –°–∫—Ä–∏–ø—Ç—ã

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
npm run tax:init-templates      # –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω—ã
npm run tax:init-rates          # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞–≤–∫–∏
npm run tax:init-prompts        # –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã
npm run tax:init                # –í—Å–µ —Å—Ä–∞–∑—É

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
npm run tax:test-export         # –¢–µ—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ PDF/DOCX

# Prisma
npm run db:generate             # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
npm run db:push                 # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã
npm run db:studio               # Prisma Studio
```

---

## üéâ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ –ü–æ–ª–Ω—ã–π CRUD –Ω–∞–ª–æ–≥–æ–≤—ã—Ö —Å–ø–æ—Ä–æ–≤
- ‚úÖ AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π AI-–∞–Ω–∞–ª–∏–∑
- ‚úÖ RAG –ø–æ–∏—Å–∫ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç–æ–≤
- ‚úÖ –†–∞—Å—á–µ—Ç –Ω–∞–ª–æ–≥–æ–≤
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç PDF/DOCX
- ‚úÖ Timeline —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:
- ‚úÖ 100% TypeScript
- ‚úÖ Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ Error handling
- ‚úÖ Logging
- ‚úÖ Comments
- ‚úÖ Clean architecture

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- ‚úÖ TimeWeb Cloud integration
- ‚úÖ S3 storage
- ‚úÖ Vector DB
- ‚úÖ PostgreSQL
- ‚úÖ Signed URLs

### AI:
- ‚úÖ GPT-4 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–º–ø—Ç—ã –≤ –ë–î
- ‚úÖ –û–±—É—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ RAG enhancement

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞: 100%
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–æ—Ä–æ–≤ ‚úÖ
- –†–∞—Å—á–µ—Ç –Ω–∞–ª–æ–≥–æ–≤ ‚úÖ
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚úÖ
- AI-–∞–Ω–∞–ª–∏–∑ ‚úÖ
- –ü–æ–∏—Å–∫ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç–æ–≤ ‚úÖ
- –≠–∫—Å–ø–æ—Ä—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚úÖ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚úÖ
- –ê–¥–º–∏–Ω–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ ‚úÖ

### Type Safety: 100%
- –ù–µ—Ç `any` —Ç–∏–ø–æ–≤ ‚úÖ
- –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è ‚úÖ
- Zod —Å—Ö–µ–º—ã ‚úÖ
- Prisma types ‚úÖ

### Error Handling: 100%
- Try-catch –±–ª–æ–∫–∏ ‚úÖ
- Fallback –ª–æ–≥–∏–∫–∞ ‚úÖ
- Error responses ‚úÖ
- Logging ‚úÖ

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### Phase 9.2 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- [ ] UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Step Wizard)
- [ ] –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] Telegram Mini App –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### Phase 9.3 (–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ):
- [ ] –ë–æ–ª—å—à–µ —Ç–∏–ø–æ–≤ –Ω–∞–ª–æ–≥–æ–≤ (property, land, NDFL)
- [ ] –ë–æ–ª—å—à–µ —Ä–µ–≥–∏–æ–Ω–æ–≤ (—Å—Ç–∞–≤–∫–∏)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –§–ù–° API
- [ ] Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] Email —Ä–∞—Å—Å—ã–ª–∫–∞

### Phase 9.4 (–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è):
- [ ] –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- [ ] Subscription plans
- [ ] Premium features
- [ ] Analytics dashboard

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `TAX_DISPUTE_AUTOMATION_CONCEPT.md` (40+ —Å—Ç—Ä–∞–Ω–∏—Ü)
- ‚úÖ `TAX_DISPUTE_MVP_PLAN.md` (30+ —Å—Ç—Ä–∞–Ω–∏—Ü)
- ‚úÖ `TAX_DISPUTE_PROGRESS_REPORT.md` (–æ—Ç—á–µ—Ç –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ)
- ‚úÖ `BACKEND_MVP_COMPLETE_REPORT.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
- ‚úÖ `ROADMAP.md` v4.0.0 (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞)

---

## üéä –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Backend MVP Phase 9.1 —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!**

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è:
- –°–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–ª–æ–≥–æ–≤—ã–º–∏ —Å–ø–æ—Ä–∞–º–∏
- AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –î–µ—Ç–∞–ª—å–Ω–æ–≥–æ AI-–∞–Ω–∞–ª–∏–∑–∞ –Ω–∞–ª–æ–≥–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- RAG-–ø–æ–∏—Å–∫–∞ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç–æ–≤ –∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –†–∞—Å—á–µ—Ç–∞ –Ω–∞–ª–æ–≥–æ–≤ —Å —É—á–µ—Ç–æ–º —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫
- –≠–∫—Å–ø–æ—Ä—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ PDF/DOCX
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è AI-–ø—Ä–æ–º–ø—Ç–∞–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
- –û–±—É—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ feedback

**–ì–æ—Ç–æ–≤–æ –∫:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
- –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ production
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –†–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

**–î–µ–¥–ª–∞–π–Ω:** 1 –Ω–æ—è–±—Ä—è 2025 - **–≤—ã–ø–æ–ª–Ω–µ–Ω –¥–æ—Å—Ä–æ—á–Ω–æ** (–∑–∞ 1 –¥–µ–Ω—å!)

---

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–ª–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ production üöÄ

