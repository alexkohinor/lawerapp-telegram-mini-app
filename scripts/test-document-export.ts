import { exportDocument } from '../src/lib/tax/document-export-service';
import consola from 'consola';

/**
 * –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ PDF –∏ DOCX
 */

const testDocument = {
  documentId: 'test-' + Date.now(),
  title: '–ó–∞—è–≤–ª–µ–Ω–∏–µ –æ –ø–µ—Ä–µ—Ä–∞—Å—á–µ—Ç–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞ –∑–∞ 2024 –≥–æ–¥',
  content: `–í –ò–Ω—Å–ø–µ–∫—Ü–∏—é –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–π –Ω–∞–ª–æ–≥–æ–≤–æ–π —Å–ª—É–∂–±—ã
‚Ññ 1 –ø–æ –≥. –ú–æ—Å–∫–≤–µ
–æ—Ç –ò–≤–∞–Ω–æ–≤–∞ –ò–≤–∞–Ω–∞ –ò–≤–∞–Ω–æ–≤–∏—á–∞
–ò–ù–ù 123456789012
–∞–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1, –∫–≤. 1
—Ç–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67

–ó–ê–Ø–í–õ–ï–ù–ò–ï
–æ –ø–µ—Ä–µ—Ä–∞—Å—á–µ—Ç–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞

–ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Å—Ç. 52, 78, 81 –ù–∞–ª–æ–≥–æ–≤–æ–≥–æ –∫–æ–¥–µ–∫—Å–∞ –†–§ –ø—Ä–æ—à—É –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø–µ—Ä–µ—Ä–∞—Å—á–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞ –∑–∞ 2024 –≥–æ–¥ –≤ —Å–≤—è–∑–∏ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏—Å—á–∏—Å–ª–µ–Ω–∏–µ–º –Ω–∞–ª–æ–≥–∞.

–û–ë–°–¢–û–Ø–¢–ï–õ–¨–°–¢–í–ê –î–ï–õ–ê:

1. –ù–∞–ª–æ–≥–æ–≤–∞—è –∏–Ω—Å–ø–µ–∫—Ü–∏—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–∏–ª–∞ –Ω–∞–ª–æ–≥–æ–≤—É—é —Å—Ç–∞–≤–∫—É –¥–ª—è –º–æ–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
2. –ù–µ —É—á—Ç–µ–Ω –ø–µ—Ä–∏–æ–¥ –≤–ª–∞–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–æ–º
3. –ú–æ—â–Ω–æ—Å—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª—è —É–∫–∞–∑–∞–Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

–°—á–∏—Ç–∞—é, —á—Ç–æ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω–∞—è —Å—É–º–º–∞ –Ω–∞–ª–æ–≥–∞ 15000 —Ä—É–±. –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–µ–π—Å—Ç–≤—É—é—â–∏–º —Å—Ç–∞–≤–∫–∞–º –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞.

–ü–†–ê–í–û–í–û–ï –û–ë–û–°–ù–û–í–ê–ù–ò–ï:

–°–æ–≥–ª–∞—Å–Ω–æ —Å—Ç. 52 –ù–ö –†–§, –Ω–∞–ª–æ–≥–æ–ø–ª–∞—Ç–µ–ª—å—â–∏–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏—Å—á–∏—Å–ª—è–µ—Ç —Å—É–º–º—É –Ω–∞–ª–æ–≥–∞, –ø–æ–¥–ª–µ–∂–∞—â—É—é —É–ø–ª–∞—Ç–µ –∑–∞ –Ω–∞–ª–æ–≥–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥, –∏—Å—Ö–æ–¥—è –∏–∑ –Ω–∞–ª–æ–≥–æ–≤–æ–π –±–∞–∑—ã, –Ω–∞–ª–æ–≥–æ–≤–æ–π —Å—Ç–∞–≤–∫–∏ –∏ –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –ª—å–≥–æ—Ç.

–í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç. 358 –ù–ö –†–§, –æ–±—ä–µ–∫—Ç–æ–º –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–æ–±–∏–ª–∏, –º–æ—Ç–æ—Ü–∏–∫–ª—ã, –º–æ—Ç–æ—Ä–æ–ª–ª—ã, –∞–≤—Ç–æ–±—É—Å—ã –∏ –¥—Ä—É–≥–∏–µ —Å–∞–º–æ—Ö–æ–¥–Ω—ã–µ –º–∞—à–∏–Ω—ã –∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã –Ω–∞ –ø–Ω–µ–≤–º–∞—Ç–∏—á–µ—Å–∫–æ–º –∏ –≥—É—Å–µ–Ω–∏—á–Ω–æ–º —Ö–æ–¥—É, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

–°—Ç–∞—Ç—å—è 361 –ù–ö –†–§ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞–ª–æ–≥–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ—â–Ω–æ—Å—Ç–∏ –¥–≤–∏–≥–∞—Ç–µ–ª—è.

–†–ê–°–ß–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û–ô –°–£–ú–ú–´ –ù–ê–õ–û–ì–ê:

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ú–æ—â–Ω–æ—Å—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª—è:                    150 –ª.—Å.         ‚îÇ
‚îÇ –°—Ç–∞–≤–∫–∞ –Ω–∞–ª–æ–≥–∞:                         35 —Ä—É–±./–ª.—Å.     ‚îÇ
‚îÇ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–ª–∞–¥–µ–Ω–∏—è:                  1.0              ‚îÇ
‚îÇ –ü–æ–≤—ã—à–∞—é—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:                1.0              ‚îÇ
‚îÇ –õ—å–≥–æ—Ç–∞:                                –ù–µ—Ç              ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–∞–ª–æ–≥–∞:               5250 —Ä—É–±.       ‚îÇ
‚îÇ –ù–∞—á–∏—Å–ª–µ–Ω–æ –Ω–∞–ª–æ–≥–æ–≤–æ–π:                   15000 —Ä—É–±.      ‚îÇ
‚îÇ –ü–µ—Ä–µ–ø–ª–∞—Ç–∞:                             9750 —Ä—É–±.       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:

–ü—Ä–æ—à—É:
1. –ü—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø–µ—Ä–µ—Ä–∞—Å—á–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞ –∑–∞ 2024 –≥–æ–¥.
2. –í–µ—Ä–Ω—É—Ç—å –ø–µ—Ä–µ–ø–ª–∞—Ç—É –≤ —Ä–∞–∑–º–µ—Ä–µ 9750 —Ä—É–±–ª–µ–π.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
1. –ö–æ–ø–∏—è —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞
2. –†–∞—Å—á–µ—Ç –Ω–∞–ª–æ–≥–∞
3. –°–ø—Ä–∞–≤–∫–∞ –æ —Å—Ç–∞–≤–∫–∞—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –Ω–∞–ª–æ–≥–∞ –≤ —Ä–µ–≥–∏–æ–Ω–µ

–î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}
–ü–æ–¥–ø–∏—Å—å: _______________ (–ò–≤–∞–Ω–æ–≤ –ò.–ò.)`,
  metadata: {
    taxpayerName: '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á',
    taxType: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π –Ω–∞–ª–æ–≥',
    period: '2024',
    generatedAt: new Date(),
  },
};

async function testExport() {
  consola.start('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...');
  
  try {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    if (!process.env.S3_ACCESS_KEY || !process.env.S3_SECRET_KEY) {
      consola.warn('‚ö†Ô∏è  S3 credentials not configured. Skipping S3 upload test.');
      consola.info('Set S3_ACCESS_KEY and S3_SECRET_KEY in .env file to test S3 upload.');
    }
    
    // –¢–µ—Å—Ç 1: –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
    consola.info('\nüìÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF...');
    const pdfResult = await exportDocument({
      ...testDocument,
      format: 'pdf',
    });
    
    if (pdfResult.success) {
      consola.success('‚úÖ PDF —ç–∫—Å–ø–æ—Ä—Ç —É—Å–ø–µ—à–µ–Ω!');
      consola.info(`   - S3 Key: ${pdfResult.s3Key}`);
      consola.info(`   - File Size: ${(pdfResult.fileSize! / 1024).toFixed(2)} KB`);
      consola.info(`   - S3 URL: ${pdfResult.s3Url}`);
    } else {
      consola.error('‚ùå PDF —ç–∫—Å–ø–æ—Ä—Ç failed:', pdfResult.error);
    }
    
    // –¢–µ—Å—Ç 2: –≠–∫—Å–ø–æ—Ä—Ç –≤ DOCX
    consola.info('\nüìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ DOCX...');
    const docxResult = await exportDocument({
      ...testDocument,
      documentId: testDocument.documentId + '-docx',
      format: 'docx',
    });
    
    if (docxResult.success) {
      consola.success('‚úÖ DOCX —ç–∫—Å–ø–æ—Ä—Ç —É—Å–ø–µ—à–µ–Ω!');
      consola.info(`   - S3 Key: ${docxResult.s3Key}`);
      consola.info(`   - File Size: ${(docxResult.fileSize! / 1024).toFixed(2)} KB`);
      consola.info(`   - S3 URL: ${docxResult.s3Url}`);
    } else {
      consola.error('‚ùå DOCX —ç–∫—Å–ø–æ—Ä—Ç failed:', docxResult.error);
    }
    
    consola.success('\nüéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
    consola.info('\nüí° –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:');
    consola.info('1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã –≤ S3: ' + S3_BUCKET);
    consola.info('2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API /api/tax/documents/[id]/export –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
    consola.info('3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API /api/tax/documents/[id]/download –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
    
  } catch (error) {
    consola.error('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
    process.exit(1);
  }
}

// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
testExport();

const S3_BUCKET = process.env.S3_BUCKET_NAME || 'lawerapp-documents';

