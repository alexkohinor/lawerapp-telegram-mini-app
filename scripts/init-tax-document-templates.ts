import { prisma } from '../src/lib/prisma';
import consola from 'consola';

/**
 * Скрипт для инициализации шаблонов налоговых документов
 */

const templates = [
  // ============================================
  // 1. Заявление о перерасчете налога (транспортный)
  // ============================================
  {
    name: 'Заявление о перерасчете транспортного налога',
    type: 'recalculation_request',
    category: 'transport',
    description: 'Шаблон заявления о перерасчете транспортного налога при ошибках в начислении',
    template: `В Инспекцию Федеральной налоговой службы
№ {{inspectionNumber}} по {{inspectionCity}}
от {{taxpayerName}}
ИНН {{taxpayerINN}}
адрес: {{taxpayerAddress}}
телефон: {{taxpayerPhone}}

ЗАЯВЛЕНИЕ
о перерасчете транспортного налога

На основании ст. 52, 78, 81 Налогового кодекса РФ прошу произвести перерасчет транспортного налога за {{taxPeriod}} в связи с неправильным исчислением налога.

ОБСТОЯТЕЛЬСТВА ДЕЛА:

{{#each grounds}}
{{@index}}. {{this}}
{{/each}}

Считаю, что начисленная сумма налога {{taxAmount}} руб. не соответствует действующим ставкам и параметрам транспортного средства.

ПРАВОВОЕ ОБОСНОВАНИЕ:

Согласно ст. 52 НК РФ, налогоплательщик самостоятельно исчисляет сумму налога, подлежащую уплате за налоговый период, исходя из налоговой базы, налоговой ставки и налоговых льгот.

В соответствии со ст. 358 НК РФ, объектом налогообложения признаются автомобили, мотоциклы, мотороллы, автобусы и другие самоходные машины и механизмы на пневматическом и гусеничном ходу, зарегистрированные в установленном порядке.

Статья 361 НК РФ устанавливает налоговые ставки в зависимости от мощности двигателя, которые могут быть увеличены (уменьшены) законами субъектов Российской Федерации, но не более чем в десять раз.

РАСЧЕТ ПРАВИЛЬНОЙ СУММЫ НАЛОГА:

┌─────────────────────────────────────────────────────────────┐
│ Мощность двигателя:                    {{enginePower}} л.с. │
│ Ставка налога:                         {{rate}} руб./л.с.   │
│ Коэффициент владения:                  {{ownershipCoef}}    │
│ Повышающий коэффициент:                {{luxuryCoef}}       │
│ Льгота:                                {{privilegeDiscount}}│
│                                                             │
│ Правильная сумма налога:               {{correctAmount}} руб.│
│ Начислено налоговой:                   {{taxAmount}} руб.   │
│ Переплата:                             {{overpaidAmount}} руб.│
└─────────────────────────────────────────────────────────────┘

ТРЕБОВАНИЯ:

Прошу:
1. Произвести перерасчет транспортного налога за {{taxPeriod}}.
2. Вернуть переплату в размере {{overpaidAmount}} рублей.

Приложения:
1. Копия свидетельства о регистрации транспортного средства
2. Расчет налога
3. Справка о ставках транспортного налога в регионе

Дата: {{currentDate}}
Подпись: _______________ ({{taxpayerName}})`,
    variables: {
      inspectionNumber: 'string',
      inspectionCity: 'string',
      taxpayerName: 'string',
      taxpayerINN: 'string',
      taxpayerAddress: 'string',
      taxpayerPhone: 'string',
      taxPeriod: 'string',
      taxAmount: 'number',
      grounds: 'array',
      enginePower: 'number',
      rate: 'number',
      ownershipCoef: 'number',
      luxuryCoef: 'number',
      privilegeDiscount: 'string',
      correctAmount: 'number',
      overpaidAmount: 'number',
      currentDate: 'string',
    },
    legalBasis: {
      'st52': 'Статья 52 НК РФ "Порядок исчисления налога"',
      'st78': 'Статья 78 НК РФ "Зачет или возврат сумм излишне уплаченных налогов"',
      'st81': 'Статья 81 НК РФ "Внесение изменений в налоговую декларацию"',
      'st358': 'Статья 358 НК РФ "Объект налогообложения"',
      'st361': 'Статья 361 НК РФ "Налоговые ставки"',
    },
  },
  
  // ============================================
  // 2. Жалоба в вышестоящий налоговый орган
  // ============================================
  {
    name: 'Жалоба в вышестоящий налоговый орган',
    type: 'complaint',
    category: 'transport',
    description: 'Шаблон жалобы в УФНС при отказе ИФНС в перерасчете',
    template: `В Управление Федеральной налоговой службы
по {{region}}
от {{taxpayerName}}
ИНН {{taxpayerINN}}
адрес: {{taxpayerAddress}}

ЖАЛОБА
на решение ИФНС № {{inspectionNumber}}

На основании ст. 137, 138 НК РФ обжалую решение ИФНС № {{inspectionNumber}} от {{decisionDate}} о доначислении транспортного налога в сумме {{taxAmount}} рублей за {{taxPeriod}}.

ОСНОВАНИЯ ДЛЯ ОТМЕНЫ РЕШЕНИЯ:

1. НАРУШЕНИЕ МАТЕРИАЛЬНОГО ПРАВА:

Налоговая инспекция неправильно применила налоговую ставку, установленную для моего региона и категории транспортного средства. 

Согласно ст. 361 НК РФ и Закону {{region}} от {{lawDate}} № {{lawNumber}}, для транспортных средств с мощностью двигателя {{enginePower}} л.с. установлена ставка {{correctRate}} руб./л.с., а не {{appliedRate}} руб./л.с., как указано в решении.

2. НАРУШЕНИЕ ПРОЦЕССУАЛЬНОГО ПРАВА:

Налоговая инспекция не учла мои возражения, представленные {{objectionDate}}, в которых я указал на ошибку в расчете налога и предоставил подтверждающие документы.

В нарушение ст. 100 НК РФ налоговая инспекция не рассмотрела мои возражения в установленный срок и не предоставила мотивированного ответа.

3. СУДЕБНАЯ ПРАКТИКА:

Позиция Верховного Суда РФ, изложенная в Постановлении Пленума № 57 от 30.07.2013, указывает на необходимость применения налоговых ставок, действующих в налоговом периоде, за который исчисляется налог.

Определение Верховного Суда РФ от {{precedentDate}} № {{precedentNumber}} подтверждает, что при наличии ошибки в расчете налога, налогоплательщик имеет право на перерасчет.

ТРЕБОВАНИЯ:

Прошу отменить решение ИФНС № {{inspectionNumber}} от {{decisionDate}} и произвести перерасчет транспортного налога за {{taxPeriod}} с учетом правильной налоговой ставки.

Приложения:
1. Копия решения ИФНС № {{inspectionNumber}} от {{decisionDate}}
2. Копия возражений от {{objectionDate}}
3. Расчет налога
4. Копия свидетельства о регистрации ТС
5. Справка о налоговых ставках

Дата: {{currentDate}}
Подпись: _______________ ({{taxpayerName}})`,
    variables: {
      region: 'string',
      taxpayerName: 'string',
      taxpayerINN: 'string',
      taxpayerAddress: 'string',
      inspectionNumber: 'string',
      decisionDate: 'string',
      taxAmount: 'number',
      taxPeriod: 'string',
      enginePower: 'number',
      correctRate: 'number',
      appliedRate: 'number',
      lawDate: 'string',
      lawNumber: 'string',
      objectionDate: 'string',
      precedentDate: 'string',
      precedentNumber: 'string',
      currentDate: 'string',
    },
    legalBasis: {
      'st137': 'Статья 137 НК РФ "Порядок обжалования актов налоговых органов"',
      'st138': 'Статья 138 НК РФ "Порядок подачи жалобы"',
      'st100': 'Статья 100 НК РФ "Вынесение решения по результатам рассмотрения материалов налоговой проверки"',
      'st361': 'Статья 361 НК РФ "Налоговые ставки"',
      'plenum57': 'Постановление Пленума ВС РФ № 57 от 30.07.2013',
    },
  },
  
  // ============================================
  // 3. Уведомление о несогласии
  // ============================================
  {
    name: 'Уведомление о несогласии с решением по жалобе',
    type: 'notice',
    category: 'transport',
    description: 'Шаблон уведомления о несогласии с решением УФНС',
    template: `В ИФНС № {{inspectionNumber}} по {{inspectionCity}}

УВЕДОМЛЕНИЕ
о несогласии с решением по жалобе

Довожу до Вашего сведения, что я не согласен с решением УФНС по {{region}} от {{decisionDate}} по жалобе № {{complaintNumber}}.

Считаю доначисление транспортного налога в сумме {{taxAmount}} рублей за {{taxPeriod}} незаконным по следующим основаниям:

1. Налоговая инспекция применила неправильную налоговую ставку, не соответствующую законодательству {{region}}.

2. Расчет налога не учитывает фактический период владения транспортным средством ({{ownershipMonths}} месяцев).

3. В решении не приведены обоснованные доводы отклонения моих возражений.

4. Нарушена процедура рассмотрения жалобы, установленная ст. 138-141 НК РФ.

Настаиваю на своей позиции, изложенной в жалобе от {{complaintDate}}, и требую произвести перерасчет налога с учетом правильной ставки {{correctRate}} руб./л.с.

Правильная сумма налога составляет {{correctAmount}} рублей, переплата - {{overpaidAmount}} рублей.

Оставляю за собой право на обращение в суд для защиты своих законных прав и интересов в соответствии со ст. 142 НК РФ.

Дата: {{currentDate}}
Подпись: _______________ ({{taxpayerName}})`,
    variables: {
      inspectionNumber: 'string',
      inspectionCity: 'string',
      region: 'string',
      decisionDate: 'string',
      complaintNumber: 'string',
      taxAmount: 'number',
      taxPeriod: 'string',
      ownershipMonths: 'number',
      complaintDate: 'string',
      correctRate: 'number',
      correctAmount: 'number',
      overpaidAmount: 'number',
      currentDate: 'string',
      taxpayerName: 'string',
    },
    legalBasis: {
      'st138': 'Статья 138 НК РФ "Порядок подачи жалобы"',
      'st139': 'Статья 139 НК РФ "Рассмотрение жалобы"',
      'st140': 'Статья 140 НК РФ "Решение по жалобе"',
      'st141': 'Статья 141 НК РФ "Действия налогового органа по исполнению решения"',
      'st142': 'Статья 142 НК РФ "Обжалование решений налоговых органов в судебном порядке"',
    },
  },
  
  // ============================================
  // 4. Возражения на акт налоговой проверки
  // ============================================
  {
    name: 'Возражения на акт налоговой проверки',
    type: 'objection',
    category: 'transport',
    description: 'Шаблон возражений на акт камеральной проверки',
    template: `В ИФНС № {{inspectionNumber}} по {{inspectionCity}}

ВОЗРАЖЕНИЯ
на акт налоговой проверки № {{actNumber}} от {{actDate}}

На основании ст. 100 НК РФ представляю возражения на акт камеральной налоговой проверки № {{actNumber}} от {{actDate}}.

НЕСОГЛАСИЕ С ВЫВОДАМИ ПРОВЕРКИ:

1. Нарушение порядка проведения проверки:

Считаю, что проверка проведена с нарушением ст. 88 НК РФ, так как мне не было направлено требование о представлении пояснений до составления акта проверки.

2. Неправильное применение налогового законодательства:

Акт содержит вывод о доначислении транспортного налога в сумме {{taxAmount}} руб. за {{taxPeriod}}, что является неверным.

Налоговая инспекция применила ставку {{appliedRate}} руб./л.с., в то время как согласно Закону {{region}} от {{lawDate}} № {{lawNumber}}, для транспортных средств категории {{vehicleType}} с мощностью двигателя от {{powerMin}} до {{powerMax}} л.с. установлена ставка {{correctRate}} руб./л.с.

3. Неправильное определение налоговой базы:

В акте указана мощность двигателя {{appliedPower}} л.с., что не соответствует техническим характеристикам транспортного средства. Согласно свидетельству о регистрации ТС, мощность составляет {{actualPower}} л.с.

4. Судебная практика:

Позиция Верховного Суда РФ, изложенная в Определении от {{precedentDate}} № {{precedentNumber}}, подтверждает необходимость применения налоговых ставок, установленных региональным законодательством.

ТРЕБОВАНИЯ:

Прошу отменить решение о доначислении транспортного налога в полном объеме и произвести перерасчет с учетом правильных параметров транспортного средства и налоговой ставки.

Приложения:
1. Копия свидетельства о регистрации ТС
2. Выписка из Закона {{region}} о транспортном налоге
3. Расчет налога
4. Технические характеристики ТС

Дата: {{currentDate}}
Подпись: _______________ ({{taxpayerName}})`,
    variables: {
      inspectionNumber: 'string',
      inspectionCity: 'string',
      actNumber: 'string',
      actDate: 'string',
      taxAmount: 'number',
      taxPeriod: 'string',
      appliedRate: 'number',
      region: 'string',
      lawDate: 'string',
      lawNumber: 'string',
      vehicleType: 'string',
      powerMin: 'number',
      powerMax: 'number',
      correctRate: 'number',
      appliedPower: 'number',
      actualPower: 'number',
      precedentDate: 'string',
      precedentNumber: 'string',
      currentDate: 'string',
      taxpayerName: 'string',
    },
    legalBasis: {
      'st88': 'Статья 88 НК РФ "Камеральная налоговая проверка"',
      'st100': 'Статья 100 НК РФ "Вынесение решения по результатам рассмотрения материалов налоговой проверки"',
      'st356': 'Статья 356 НК РФ "Общие положения"',
      'st361': 'Статья 361 НК РФ "Налоговые ставки"',
    },
  },
];

async function initializeTaxDocumentTemplates() {
  consola.start('Инициализация шаблонов налоговых документов...');
  
  try {
    // Очистка существующих шаблонов (опционально)
    const deleteCount = await prisma.taxDocumentTemplate.deleteMany({});
    consola.info(`Удалено существующих шаблонов: ${deleteCount.count}`);
    
    // Создание новых шаблонов
    let createdCount = 0;
    
    for (const template of templates) {
      await prisma.taxDocumentTemplate.create({
        data: template,
      });
      createdCount++;
      consola.success(`✅ Создан шаблон: ${template.name}`);
    }
    
    consola.success(`\n🎉 Успешно создано ${createdCount} шаблонов документов!`);
    
    // Статистика
    const stats = await prisma.taxDocumentTemplate.groupBy({
      by: ['type', 'category'],
      _count: true,
    });
    
    consola.info('\n📊 Статистика по типам:');
    stats.forEach((stat) => {
      consola.info(`  - ${stat.type} (${stat.category}): ${stat._count} шт.`);
    });
    
  } catch (error) {
    consola.error('❌ Ошибка при инициализации шаблонов:', error);
    process.exit(1);
  } finally {
    await prisma.$disconnect();
  }
}

// Запуск скрипта
initializeTaxDocumentTemplates();

